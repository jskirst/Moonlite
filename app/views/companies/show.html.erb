<section id="company-profile">
	<h1><%= @company.name %></h1>
	<ul class="tabs">
		<li class="active"><a href="#">Users</a></li>
		<li><%= link_to "Settings", edit_company_path(@company) %></li>
		<li><%= link_to "User Rolls", user_rolls_path %></li>
	</ul>
	<section id="users">
		<h2 style="margin-bottom:15px;">Registered Users</h2>
		<% if @users.empty? %>
			<p>You do not have any users for your organization yet.</p>
		<% else %>
		<table>
			<thead>
				<tr>
					<th>#</th>
					<th>Name</th>
					<th>User Roll</th>
					<th>Enrolled Challenges</th>
					<th>Points Earned</th>
					<th>Status</th>
				</tr>
			</thead>
			<tbody>
				<% user_counter = 0 %>
				<% @users.each do |u| %>
					<tr>
						<td><%= user_counter.to_s %></td>
						<td><%= link_to u.name, u %></td>
						<td><%= link_to u.user_roll.name, edit_roll_user_path(u) %></td>
						<%
							enrolled_paths = []
							u.enrolled_paths.each do |p|
								enrolled_paths << p.name
							end
							enrolled_paths = enrolled_paths.join(", ")						
						%>
						<% if enrolled_paths.blank? %>
							<td>None</td>
						<% else %>
							<td><%= truncate(enrolled_paths, :length => 60) %></td>
						<% end %>
						<td><%= u.earned_points.to_s %></td>
						<td>
						<% if current_user == u %>
							<%= link_to "Delete", "#", :class => "btn secondary disabled" %>
						<% else %>
							<%= link_to "Delete", u, :method => "delete", :confirm => "Are you sure you want to delete this user?", :class => "btn secondary" %>
						<% end %>
						</td>
					</tr>
					<% user_counter += 1 %>
				<% end %>
			</tbody>
		</table>
		<% end %>
		<p><%= link_to "Add user", new_user_path(:company_id => @company), :class => "btn primary" %></p>
		<hr/>
		<h3>Awaiting reply from:</h3>
		<% if @unregistered_users.empty? %>
			<p>There are no outstanding user invitations.</p>
		<% else %>
		<ol>
			<% @unregistered_users.each do |u| %>
			<li><%= u.email %></li>
			<% end %>
		</ol>
		<% end %>
	</section>
</section>
