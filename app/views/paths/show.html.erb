<% if @must_register && @completed %>
<script>
$(function(){
  $('a').not(".clickable_link").attr("href", "#");
  $('#save_score, a').not(".clickable_link").click(function(){
    $('#jumpstart_registration_modal').modal({
      keyboard: true,
      backdrop: 'static',
      show: true
    });
  });
});
</script>
<%= render "users/jumpstart_registration", { :user => current_user, :path => @path } %>
<% end %>
<script>
function show_creative_list(){
  console.log(this);
  $('#creative_tasks_list').show();
  $('#knowledge_tasks_list').hide();
  $('.creative_link').addClass('underlined');
  $('.creative_link').siblings('a').removeClass('underlined');
}

function show_knowledge_list(){
  $('#knowledge_tasks_list').show();
  $('#creative_tasks_list').hide();
  $('.knowledge_link').addClass('underlined');
  $('.knowledge_link').siblings('a').removeClass('underlined');
}

$(function(){
  $(".vote_button").on("ajax:success",
    function(event, data){
      if(data.errors){
        alert(data.errors);
      } else {
        console.log($(this).parents("li:first").children("div:last"));
        var $vote_counter = $(this).parents("li:first").children("div.vote_count");
        console.log($vote_counter);
        var votes = parseInt($vote_counter.text());
        console.log(votes);
        if($(this).hasClass("primary")){
          $(this).removeClass("primary").addClass("secondary").text("Vote");
          $vote_counter.html("<span class='label notice' style='font-size: 16px;'>+"+(votes-1)+"</span>");
        } else if($(this).hasClass("secondary")){
          $(this).removeClass("secondary").addClass("primary").text("Voted");
          $vote_counter.html("<span class='label notice' style='font-size: 16px;'>+"+(votes+1)+"</span>");
        }
      }
    }
  );
});
</script>
<section>
  <% unless @completed %>
  <div style="min-height: 120px;">
    <div style="float:left; margin: 0px 15px 0px 0px;">
      <%= image_tag(@path.path_pic, :size=>"100x100") %>
    </div>
    <div>
    <% unless @enrolled %>
      <%= form_for current_user.enrollments.build(:path_id => @path.id) do |f| %>
        <%= f.hidden_field :path_id %>
        <%= f.submit "Start "+name_for_paths, :class=> "btn primary", :style => "margin: 10px 40px 0px 0px; float:right;" %>
      <% end %>
    <% else %>  
      <%= link_to @start_mode, continue_path_path(@path), :class => "btn primary", :style => "margin: 10px 40px 0px 0px; float:right;"%>
    <% end %>
    </div>
    <div>
      <h1 style="margin-bottom: 0px;"><%= @path.name %></h1>
    </div>
    <div style="padding:15px 30px 0 10px;">
      <div class="description"><%= @path.description.html_safe %></div>
    </div>
  </div>
  <% else %>
  <div class="row">
    <div class="span3" style="width: 130xp;">
      <ul class="media-grid">
        <li>
          <a>
            <%= image_tag @path.path_pic, :style => "min-height: 100px; max-height: 105px; max-width: 130px;" %>
          </a>
        </li>
      </ul>
    </div>
    <div class="span13" style="margin: 0 0 0 0px; ">
      <h1 style="margin-bottom:2px; text-decoration: underline;">Congratulations!</h1>
      <p style="font-size:13px; font-style: italic; font-weight:bold; margin-bottom: 10px;">You have successfully completed this <%= name_for_paths.downcase %></p>
      <div>
        <p style="line-height:20px; font-size:17px;">
          You're now ranked <strong><%= @user_rank %></strong> with <strong><%= pluralize(@total_points_earned.to_i, "point") %></strong>. You reached a skill ranking of <strong><%= @skill_ranking.to_s %></strong>.
          <% if @next_rank_points.to_i > 0 %>You only need <%= pluralize(@next_rank_points.to_i, "point") %></strong> to move up to the next rank!<% end %>
        </p>
      </div>
    </div>
  </div>
  <% end %>
  <hr style="margin:10px;"/>
  <section>
    <div class="row">
      <div class="span3">
        <%= render "side_leaderboard" %>
      </div>
      <div class="span10" style="border-left:1px solid #DDD; border-right:1px solid #DDD; padding:0px 20px;">
      <% if @must_register && @completed %>
        <div style="height: 900px;">
          <p style="font-size: 18px; line-height:25px;"><%= link_to "Save your score", signin_path %> so that people can vote for your submissions, and so that you can vote on theirs!</p>
          <p style="font-size: 18px; line-height:25px;">Once you save your score, you can also take the next level of this challenge to improve your global ranking, create your own challenges and start a <%= link_to "Persona", "#" %>.</p>
        </div>
      <% elsif !@completed %>
        <div style="height: 900px;">
          <p style="font-size: 18px; line-height:25px;">Complete the first level of this challenge so you can see where you rank on the global leaderboard and vote on other people's answers!</p>
          <% unless @enrolled %>
            <%= form_for current_user.enrollments.build(:path_id => @path.id) do |f| %>
              <%= f.hidden_field :path_id %>
              <%= f.submit "Start "+name_for_paths, :class=> "btn primary really_big clickable_link", :style => "margin: 20px 180px;" %>
            <% end %>
          <% else %>  
            <%= link_to @start_mode, continue_path_path(@path), :class => "btn primary really_big clickable_link", :style => "margin: 20px 160px;"%>
          <% end %>
        </div>
      <% else %>
        <% if @show_voting %>
          <% unless @in_drill_down %>
          <div class="row" style="margin-bottom:15px;">
            <div style="float:left; padding:0 10px; cursor:pointer;">
              <a onclick="show_creative_list();" class="underlined creative_link">Creative</a> | 
              <a onclick="show_knowledge_list();" class="knowledge_link" >Knowledge</a>
            </div>
            <div style="float:right; padding:0 10px;">
              <%= link_to "Newest", 
                finish_path_path(@path, :order => "recent"), 
                :class => (@order.include?("votes") ? "" : "underlined") %> | 
              <%= link_to "Most Votes", 
                finish_path_path(@path, :order => "votes"), 
                :class => (@order.include?("votes") ? "underlined" : "") %>
            </div>
          </div>
          <%= render "voting_explanation" %>
          <% else %>
          <div class="row" style="margin-bottom:15px;">
            <div style="float:left; padding:0 10px;">
              <%= link_to "<<< Back", finish_path_path(@path, :order => "recent") %>
            </div>
          </div>
          <% end %>
          <%= render "creative_tasks_list" %>
        <% end %>
        <%= render "knowledge_tasks_list" %>
      <% end %>
      </div>
      <div class="span2">
        <ul class="media-grid">
          <% @similar_paths.each do |similar_path| %>
            <li><%= link_to image_tag(similar_path.path_pic, :size => "100x90", :title => similar_path.name), similar_path, :class => (similar_path.is_locked ? "locked_challenge" : "") %>
          <% end %>
        </ul>
      </div>
    </div>
  </section>
</section>