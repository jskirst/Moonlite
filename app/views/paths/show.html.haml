%section
  - unless current_user
    %div#newuserbox.help_box{ style:"background-color:#FFF7CD; padding-bottom:15px; padding-right:15px;" }
      %div.help_close{style:"position:relative; left:10px;"}
        %img{src: "https://s3.amazonaws.com/moonlite-nsdub/static/close_icon.png" }
      %div{ style: "margin-top:-6px;"}
        %img{src:"https://s3.amazonaws.com/moonlite-nsdub/static/stoney+100x150.png", style: " display:inline; height:90px; "}
        %h1{style:"display:inline; position:relative; top:12px; font-size: 30px;"} Looks like you're new here...
      %div{style:"margin-left:20px; margin-top:-10px;"}
        %h4 MetaBright is a place to showcase your skills and get better at the stuff you're passionate about. Learn more about us <a href="/about">here</a>.
        %h4{style:"margin-top:15px;"} Poke around a little bit, and when you're ready to join the Challenge yourself, come back here to <a class="login_link">sign up</a>. It only takes five seconds. Honest!
  %div#topsection
    %div#updatespace
      %div{ style: "display:inline;" }
        = link_to challenge_path(@path.permalink) do
          = image_tag @path.path_pic, class: "bigheaderimage"
      %div.rightofbigheaderimage{ style: "width:81%;" }
        %div#topboxcontent
          - if current_user
            %div.button.button-actionable{ style: "float: right;"} Continue Level #{@enrollment.level} Â»
          %div{ style: "width: 550px; margin-top: 10px;" }
            %h1= @path.name
            - if current_user
              %h3{ style: "font-size: 18px; line-height:33px; " } Level #{@enrollment.level}, #{@enrollment.total_points} points
            - else              
              %h4{ style: "height: 42px; cursor: pointer; margin-top:4px;" }
                %a.login_link Login or register to join this Challenge!
        %div#challengecarousel_container
          - if @enrollments.size > 4
            %div#challengeleft_scroll
              %a{href: "javascript:challengeslide(\"left\");"}
                %img{src: "https://s3.amazonaws.com/moonlite-nsdub/static/random+icons/arrow_angle_left_light.png"}/
          %div#challengecarousel_inner{ style: "#{@enrollments.size < 4 ? 'margin-left: -12px;' : ''}" }
            %ul#challengecarousel_ul
              - if @enrollments.size < 4
                = render "shared/mosaic", { custom_class: "addthis_button_facebook", link: "#", title: "Sharing is caring", subtitle: "Spread the MetaBright Gospel!", pic: "https://s3.amazonaws.com/moonlite-nsdub/static/carousel_images/fb_green_carousel.png" }
              - @enrollments.shuffle.each do |e|
                = render "shared/mosaic", { pic: e.user.picture, link: profile_path(e.user.username), title: e.user.name, subtitle: "Level #{e.level}, #{e.total_points} points" }
          - if @enrollments.size > 4
            %div#challengeright_scroll
              %a{href: "javascript:challengeslide(\"right\");"}
                %img{src: "https://s3.amazonaws.com/moonlite-nsdub/static/random+icons/arrow_angle_right_light.png"}/
      %input#challengehidden_auto_slide_seconds{:type => "hidden", :value => "0"}/
  %div.row
    %div.span5
      %div.leftbox.newsfeed{ style: "min-height: 361px;" }
        %div.leftboxheader#leaderboard_pop{style: "padding: 10px 12px; "} Leaderboard
        %ul#ranks{ style: "padding: 0px;"}
          - current_user_in_top = false
          - @leaderboard.each_with_index do |user, i|
            - current_user_in_top = true if current_user && user.id = current_user.id
            - break if i >= 10
            %li
              %span.rank= (i+1).to_s
              = image_tag user.picture 
              = link_to truncate(user.name, length: 22), profile_path(user.username), class: "name"
              %span.level lvl. #{Enrollment.points_to_level(user.total_points.to_i)}
              %span.points= user.total_points
          - unless current_user.nil? || current_user_in_top
            - current_user_spot = nil
            - previous_user = nil
            - next_user = nil
            - @leaderboard.each_with_index do |user, i|
              - if current_user_spot
                - next_user = user and break
              - elsif user.id = current_user.id
                - current_user_spot = i
              - else
                - previous_user = user
            - if current_user_spot
              - if previous_user
                %li
                  %span.rank= (current_user_spot).to_s
                  = image_tag previous_user.picture 
                  = link_to truncate(previous_user.name, length: 22), profile_path(previous_user.username), class: "name"
                  %span.level lvl. #{Enrollment.points_to_level(previous_user.total_points.to_i)}
                  %span.points= previous_user.total_points
              %li
                %span.rank= (current_user_spot+1).to_s
                = image_tag user.picture 
                = link_to truncate(user.name, length: 22), profile_path(user.username), class: "name"
                %span.level lvl. #{Enrollment.points_to_level(user.total_points.to_i)}
                %span.points= user.total_points
              - if next_user
                %li
                  %span.rank= (current_user_spot+2).to_s
                  = image_tag next_user.picture 
                  = link_to truncate(next_user.name, length: 22), profile_path(next_user.username), class: "name"
                  %span.level lvl. #{Enrollment.points_to_level(next_user.total_points.to_i)}
                  %span.points= next_user.total_points
                
      
      - if @similar_paths
        %div.leftbox
          %div.leftboxheader Similar Challenges
          %div.leftboxfooter{style:"background-color:white;"}
            %li.leftrailcontent
              - @similar_paths.each do |p|
                = link_to challenge_path(p.permalink) do
                  = image_tag p.picture, class: "leftrailicon", title: "#{p.name}"
    %div.span11
      %div.newsfeed
        %div.leftboxheader
          %div{ style: "display:inline;" }
            %span{ style: "border-bottom: 0px; padding-top:1px;" } Stream
            = link_to "Date", challenge_path(@path.permalink, order: "date"), class: "btn leftbtn"
            = link_to "Votes", challenge_path(@path.permalink, order: "votes"), class: "btn midbtn"
            - if @path
              %a.btn.rightbtn{ onclick: "$(this).parents('.leftboxheader').find('.questions_filter').slideDown();" } Question
          - if @path
            %div.questions_filter{ style: "display:none; text-transform: none;" }
              %p{ style: "font-size: 13px; margin: 10px 5px; color: black;" } Click on one of the questions below to see responses only for that question.
              %ol
                - @path.sections.each do |s|
                  - s.challenge_tasks.each do |task|
                    %li{ style: "padding: 5px;" }= link_to truncate(task.question, length: 80), task_details_path(@path, task.id), style: "font-size: 14px; text-decoration: none; color: #0064CD"

        :javascript
          $(function(){
            $.ajax({ type: "GET", url: "#{@url_for_newsfeed}", success: function(data){ $(".empty_post").replaceWith(data); } });
          });
        %div.post.empty_post{ style: "height: 300px;"}