- if current_user && @current_section
  %div#launchpad.dropdown_modal.modal.hide.fade{ style: "top: 5%;"}
    %div.overlay
      %div.launchpad
        %div.modal_close
          %img{:src => "https://s3.amazonaws.com/moonlite-nsdub/static/close_icon.png"}
        %h1
          = image_tag(@path.path_pic)
          %div #{@path.name} 
          %div{ style: "font: normal 18px 'MuliItalic', sans-serif;" } - #{@enrollment.total_points} pts, Level #{current_user.level(@path)}
        %div.launchpadcontent
          %div.launchpadsectioncolumn
            %div.launchpadcolumnheader
              Sections
            %ul.sectionlist
              - @path.sections.all(order: "id ASC").each do |s|
                %li.launchpad_link{ title:"#{s.name}"}
                  - if s.points_until_unlock(@enrollment) <= 0
                    %div{ style: "display:inline-block; width:75%; line-height:16px;" }
                      = link_to launchpad_section_path(s), remote: true do
                        %span.pointer_caret= "»" if s == @current_section
                        %span= truncate(s.name, length: 40)
                    %div.pointsandprogress
                      %div #{s.points_earned(current_user)} pts
                      %div #{s.percentage_complete(current_user)}%
                  - elsif s.points_to_unlock == 9999
                    %div{ style: "line-height: 16px;" }= truncate(s.name, length: 25)
                    %p{ style: "font-size: 9px; line-height: 12px;" } Coming soon!
                  - else
                    %div{ style: "line-height: 16px;" }= truncate(s.name, length: 25)
                    %p{ style: "font-size: 9px; line-height: 12px;" } #{s.points_until_unlock(@enrollment)} more points to unlock
          = render "sections/launchpad"
  
  :javascript
    function display_progress_bar(){
      var name = "#{@current_section.name}";
      var trunc_name = truncate(name, 15);
      var chart;
      chart = new Highcharts.Chart({
        chart: { renderTo: 'sectionpointchart', type: 'bar' },
        credits: { enabled: false },
        title: { text: null },
        xAxis: { min:0, categories: [''] },
        yAxis: { min: 0, max: 100, width: 450, title: { text: 'Percent Complete' } },
        legend: {
            backgroundColor: '#FFFFFF',
            reversed: true,
            align:'right',
            layout:'vertical',
            verticalAlign: 'top',
        },
        tooltip: { formatter: function() { return '' + this.series.name + ': ' + this.y + ''; } },
        plotOptions: { series: { stacking: 'normal' } },
        navigation: { buttonOptions: { enabled: false } },
        series: [ { name: trunc_name, data: [#{@current_section.percentage_complete(current_user)}] } ]
      });
      apply_hightcharts_theme();
    }
    
    $(function(){
      $("#topboxcontent .button-actionable").click(function(){
        $('#launchpad').modal({ keyboard: true, backdrop: 'static', show: true });
        display_progress_bar();
      });
       
      $(".launchpad_link").on("ajax:success", function(xhr, data, etc){
        $("span.pointer_caret").remove();
        $(".sectioninfocontainer").replaceWith(data);
        $(this).find("a").prepend("<span class='pointer_caret'>» </span>");
      });
    });
  
  - if @display_launchpad
    :javascript
      $(function(){ 
        $('#launchpad').modal({ keyboard: true, backdrop: 'static', show: true });
        display_progress_bar(); 
      });