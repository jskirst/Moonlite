%nav.navbar.navbar-fixed-top
  %div.fill.navbar-inner{ style: "height: 100%;" }
    %div{ style: "margin-left: 6%; height: 100%;" }
      %div.brand{ style: "padding-top: 3px; width: 150px;" }
        = link_to root_url do
          = image_tag("https://s3.amazonaws.com/moonlite-nsdub/static/MB+logo+nav+bar.png", alt: "MetaBright")
      - if current_user and show_nav_bar and @group
        %ul.nav.navicons{ style: "height: 100%; margin-left: 10px;border-left: 1px solid #020D25;" }
          %li.navitem{ title: "Evaluations", style: "height: 100%; border-left: 1px solid #56698B;" }
            = link_to group_evaluations_path(@group) do
              = image_tag NAVBAR_EVALUATIONS,  alt: "Evaluations"
              %span Evaluations
          %li.navitem{ title: "Challenges", style: "height: 100%;" }
            = link_to group_paths_url(@group) do
              = image_tag NAVBAR_CHALLENGES, style: "", alt: "Challenges"
              %span Challenges
          - if @group.is_private?
            %li.navitem{ title: "Account", style: "height: 100%;" }
              = link_to account_group_path(@group) do
                = image_tag NAVBAR_ACCOUNT, style: "", alt: "Account"
                %span Account
          - else
            %li.navitem{ title: "Dashboard", style: "height: 100%;" }
              = link_to dashboard_group_path(@group) do
                = image_tag NAVBAR_ACCOUNT, style: "", alt: "Dashboard"
                %span Dashboard
          %li.navitem{ title: "Developer", style: "height: 100%;" }
            = link_to sandbox_group_path(@group) do
              = image_tag NAVBAR_API, alt: "Developer"  
              %span Developer
          %li.navitem{"data-target" => "#more_nav", "data-toggle" => "collapse", :role => "button", title: "Expand", style: "height: 100%;" }
            = link_to "#" do
              = image_tag NAVBAR_VERTICAL_DOTS, alt: "Expand" 
          #more_nav.collapse
            %div{ style: "width: 201px; height: 100%"}
              %li.navitem{ title: "Explore", style: "float: left; height: 100%" }
                %a.explore_link{ style: "display: block;" }
                  = image_tag NAVBAR_EXPLORE, style: "", alt: "Explore"
                  %span Explore
              %li.navitem{ title: "Profile", style: "float: left; height: 100%;" }
                = link_to profile_path(current_user.username), style: "display: block;" do
                  = image_tag NAVBAR_PROFILE, alt: "Profile"  
                  %span Profile
      - elsif current_user and show_nav_bar
        %ul.nav.navicons{ style: "height: 100%; margin-left: 10px;border-left: 1px solid #020D25; border-right: 1px solid #56698B;" }
          %li.navitem{ title: "Home", style: "height: 100%; border-left: 1px solid #56698B;" }
            = link_to root_url do
              = image_tag NAVBAR_HOME,  alt: "Home"
              %span Home
          %li.navitem{ title: "Explore", style: "height: 100%;" }
            %a.explore_link
              = image_tag NAVBAR_EXPLORE, style: "", alt: "Explore"
              %span Explore
          - if current_user.earned_points > 1500
            %li.navitem{ title: "Create", style: "height: 100%;" }
              = link_to paths_path do
                = image_tag NAVBAR_CREATE, style: "", alt: "Create"
                %span Create
          %li.navitem{ title: "Profile", style: "height: 100%;" }
            = link_to profile_path(current_user.username) do
              = image_tag NAVBAR_PROFILE, alt: "Profile"  
              %span Profile
      %div{ style: "margin-left: 10px; padding-top: 10px; display: inline-block;" }
        = image_tag ICON_LOADING, alt: "Loading...", style: "display: none; width: 20px;", id: "page_loading"
      - if current_user and show_nav_bar
        %ul.nav.pull-right{ style: "float:right; margin-right: 6%; " }
          - if current_user
            %li.navuser
              %div.dropdown.pull-right
                - if current_user.guest_user?
                  %a.button.btn-danger.login_link{ style: "padding:3px 7px; border-radius:2px; margin-top:3px; margin-right: 17px; text-shadow:none; color:white;" } Sign up
                - else
                  %a.dropdown-toggle{ "data-toggle" => "dropdown"}
                    = image_tag current_user.picture, style: "width: 17px; height: 17px; vertical-align: middle;", alt: "#{@current_user.name}"
                    %span.users_name{ style: "vertical-align: middle;" }= current_user.name 
                    %span.caret
                %ul.dropdown-menu{ role: "button", style: "padding: 0; top:38px; right:-136px; min-width: 312px; min-height: 135px;" }
                  %div
                    %div.nub{ style: "left:150px;" }
                  - groups = Group.cached_find_by_user_id(current_user.id)
                  - if groups.size > 0                    
                    %div.leftboxheader Your Groups
                    %div.leftboxfooter{style:"padding:0; background-color:white; border-bottom: 1px solid #DDD; border-radius: 0; "}
                      - groups.each do |group|
                        = link_to group_path(group.permalink), style: "text-decoration: none;" do
                          %div.singlegroupentry{ style: "padding: 6px 12px; "}
                            = image_tag group.picture, style: "display: inline-block; height: 50px; width: 50px;", class: "img-circle"
                            %div{ style: "margin-left: 5px; display: inline-block; color: gray; vertical-align: middle; "}
                              %div{ style: "font-size: 20px; line-height: 23px; "} #{truncate(group.name, length:22, separator: ' ')}
                              %div{ style: "font-size: 13px; "} #{truncate(group.description, length: 41, separator: ' ')}
                  %div.leftboxheader Your Challenges
                  %div.leftboxfooter{style:"padding:0; background-color:white; max-height: 412px; overflow-y:auto;"}
                    - current_user.enrollments.includes(:path).where("total_points > 0").order("total_points DESC").each do |e|
                      = link_to challenge_path(e.path.permalink) do
                        %div.singleprogressentry
                          = image_tag e.path.image, style: "width: 50px; height: 50px;", alt: "#{e.path.name}"            
                          %div.challengeprogress
                            %span{ style: "font-size:18px;"} #{truncate(e.path.name,length: 18, separator: ' ')}
                            %span{style: "font-size:14px; float:right; "} Level #{e.level}
                            %span{ style: "position:relative; bottom:3px;display:block; line-height:16px;"} #{e.points_to_next_level} more points to level up!
                            %div.progress.progress-info
                              %div.bar{ style: "width: #{e.level_percent}%;"}
            %li
              %div.dropdown.pull-right.notification-icon{ style: "padding-top: 11px;" }
                %a.dropdown-toggle{ "data-toggle" => "dropdown", onclick: "mark_notifications_as_read();", style: "padding:10px;" }
                  = image_tag ICON_NOTIFICATIONS, style: "width: 18px; height: 18px;", title: "Notifications", alt: "Notifications"
                  - if unread_notification_count > 0
                    %span.notifications_bubble= unread_notification_count
                %ul.dropdown-menu{ role: "button", style: "padding: 0 0 10px 0; top:42px; right:-104px; min-width: 317px; min-height: 135px;" }
                  %div
                    %div.nub
                  %div.leftboxheader Notifications
                  %div.leftboxfooter{style: "padding: 0;background-color: white;max-height: 352px;overflow-y: auto;"}
                    - notifications.each do |event|
                      %li.notification_space
                        %div.notification{ class: "#{event.read_at ? '' : 'notification-unread'}" }
                          %a{ href: (event.username.nil? ? "#" : profile_path(event.username)) }
                            %img.photo{ src: event.image_link, style: "width:35px; height: 35px;", alt: "Notification" }
                          %a{ href: event.link }
                            %p.notification_body= event.content
                            %p.notification_time #{time_ago_in_words(event.created_at)} ago
            %li
              %div.dropdown.pull-right.notification-icon{ style: "padding-top:9px;" }
                %a.dropdown-toggle{ "data-toggle" => "dropdown", style: "padding:10px;" }
                  %img{ src: ICON_GEAR, style: "height:20px; width:20px;", title:"Settings", alt: "Settings"}
                %ul.dropdown-menu{ role: "button", style: "margin:0px;padding: 0 0 0px 0; top:43px; right:-39px; min-width: 25px; min-height: 50px;" }
                  %li
                    %div
                      %div.nub{ style: "left: 62px;"}
                    %div{ style: "padding: 3px 0px;"}
                      %ul.profile_dropdown{ style: "list-style: none; margin: 0px;"}
                        - if @enable_administration
                          %li= link_to "Admin", admin_overview_path, style: "border-bottom: 1px solid #DDD; color: inherit; text-shadow: none;"
                        %li= link_to "Edit Profile", edit_user_path(current_user.username), style: "border-bottom: 1px solid #DDD; color: inherit; text-shadow: none;"
                        %li.invite_facebook_friends= link_to "Invite Friends", "#", style: "border-bottom: 1px solid #DDD; color: inherit; text-shadow: none;"
                        %li= link_to "MetaBright Labs", ideas_path, style: "border-bottom: 1px solid #DDD; color: inherit; text-shadow: none;"
                        %li= link_to "Sign out", signout_path, style: "color: inherit; text-shadow: none;"
      - if current_user.nil? && show_sign_in
        %ul.nav.pull-right{ style: "float:right; margin-right: 197px; " }         
          %li{ style: "margin-top: 4px;"} 
            = link_to "Employer? We can turbocharge your recruiting.", "/employers", class: "employers_link"
          %li
            %a.button.btn-danger.login_link{ style: "padding:3px 7px; border-radius:2px; margin-top:6px; text-shadow:none; color:white;" } Sign in
      - elsif current_user and params[:controller] == "sections" and params[:action] != "new"
        %ul.nav.pull-right{ style: "float:right; margin-right: 175px;" }
          %li
            %div{ style: "width: 300px; margin-top: 2px;"}
              = image_tag @path.image, style: "width: 32px; height: 32px; margin-top: 2px;", alt: "#{@path.name}"            
              %div{ style: "vertical-align: top; width: 255px; margin-left: 5px; display: inline-block; color: white;" }
                %span Level #{@enrollment.level} - #{@enrollment.points_to_next_level} more points to next level
                %div.progress.progress-info{ style: "height: 10px; margin:0;" }
                  %div.bar{ style: "width: #{@enrollment.level_percent}%;"}
