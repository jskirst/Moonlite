%script{ src: HIGHCHARTS_JS }
:javascript
  $(function(){
    $("#results_list li:first").addClass("active");
    $(".evaluation:first").show();
    $("#results_list li").click(function(){
      $(".evaluation").hide();
      $("#"+$(this).data("permalink")).show();
      $("#results_list li").removeClass("active");
      $(this).addClass("active");
    })
    $.MB.initEvaluationGradeCharts();
  });

:css
  body{ background-image: url("https://s3.amazonaws.com/moonlite-nsdub/static/Backgrounds/gplaypattern.png"); background-repeat: repeat; background-size: auto; }
  .container.body {width: 980px; }
  .aboutcontainer{ width: 980px; margin-top: 25px; border-radius: 0; }
  .header { margin: 0 0 20px 0; }
  [data-tip]:before { left: 7px; }
  [data-tip]:after { left: -17px; }
  .table_tip [data-tip]:before { left: 34px; top: 35px;}
  .table_tip [data-tip]:after { left: 8px; top: 44px; width: 165px; height: 52px; white-space: normal; }
  .ms [data-tip]:after { width: 276px; height: 143px; top: 23px; left:-20px; white-space: normal;}
  .ms [data-tip]:before { left: 3px; }
  
#evaluations_overview.aboutcontainer
  #grade.aboutbox
    .header
      %div
        = image_tag @user.picture, style:"display:inline; height:61px;", alt: "Stoney"
        %div{ style: "display: inline-block; vertical-align: top; margin-left: 5px; "}
          %h2{ style: "font-size: 30px; margin-bottom: -10px; margin-top: -3px; " }= @user.name
          - if @evaluation
            %h3{ style: "font-size:20px; "}
              = link_to @evaluation.title, group_evaluation_path(@group, @evaluation)
        %div{ style: "display: inline-block; vertical-align: top; float: right; text-align: right; margin-top: 10px; "}
          %h3{ style: "font-size:17px; line-height: 25px"}
            = link_to @user.email, "mailto:#{@user.email}"
          - if @user.country
            - country = Carmen::Country.coded(@user.country)
            %h3{ style: "font-size:17px; line-height: 25px"} #{@user.city}, #{country.subregions.coded(@user.state).name}, #{country.name}
      - if @evaluation_enrollment
        .actions
          - if @evaluation_enrollment.submitted_at
            %span.submitted_at Submitted #{time_ago_in_words(@evaluation_enrollment.submitted_at)} ago
          = link_to group_evaluation_url(@group, @evaluation) do
            %div{ "data-tip" => "Back" }
              = image_tag "https://s3.amazonaws.com/moonlite-nsdub/static/random+icons/back.png"
          - if @evaluation_enrollment.archived_at
            = link_to save_group_evaluation_url(@group, @evaluation, user_id: @user.id, mode: "unarchive"), method: :put do 
              / Longer Text in this tip will not fit
              %div{ data: { tip: "Un-Archive" } }
                = image_tag "https://s3.amazonaws.com/moonlite-nsdub/static/random+icons/archive_selected.png", style: "margin-right: 0"
          - elsif @evaluation_enrollment.favorited_at
            = link_to save_group_evaluation_url(@group, @evaluation, user_id: @user.id, mode: "unfavorite"), method: :put do
              / Longer Text in this tip will not fit
              %div{ data: { tip:  "Un-Favorite" } }
                = image_tag "https://s3.amazonaws.com/moonlite-nsdub/static/random+icons/favorite_selected_darker.png", style: "margin-right: 0"
          - else
            = link_to save_group_evaluation_url(@group, @evaluation, user_id: @user.id, mode: "archive"), method: :put do
              %div{ "data-tip" => "Archive" }
                = image_tag "https://s3.amazonaws.com/moonlite-nsdub/static/random+icons/archive.png"
            = link_to save_group_evaluation_url(@group, @evaluation, user_id: @user.id, mode: "favorite"), method: :put do
              %div{ "data-tip" => "Favorite" }
                = image_tag "https://s3.amazonaws.com/moonlite-nsdub/static/random+icons/favorite.png", style: "margin-right: 0;"
    .body
      %ul#results_list.nav.nav-tabs
        - @results.each do |r|
          %li{ data: { permalink: r[:permalink], name: r[:name] } }
            %a= truncate(r[:name], length: 15, separator: ' ')
      .evaluations
        - if @results.empty?
          %p This user has submitted this evaluation but has no results listed. It is possible that the evaluation has been changed since this user completed the evaluation, and their results are no longer valid.
        - @results.each do |r|
          - path = Path.where(name: r[:name]).first
          .evaluation.hide{ id: r[:permalink] }
            - unless path.difficult?
              = render "paths/difficulty_warning"
            .header{ style: "padding-left: 0;"}
              %h3 Candidate Summary
              - skill_level = Enrollment.describe_skill_level(r[:metascore])
              - if r[:metascore] < 260
                - ms_for_graph = 260
              - else 
                - ms_for_graph = r[:metascore]
              .metascore_graph{ :data => { "metascore" => ms_for_graph, "skill" => skill_level } }
              .clear_floats
            .challenge_stats
              -# .myrank
              -#   %span #
              -#   %p Percentile Rank
              .big_skill_space
                .big_skill.label{ class: skill_level.downcase}
                  = skill_level
                .text
                  MetaScore Ranking
                  .ms{ style: "display: inline-block;" }                    
                    .tip-below{ style: "display: inline-block;", data: {tip: "This is the skill level MetaBright estimates this person to possess in this Challenge. Our algorithm takes analyzes many variables to reach this conclusion such as question difficulty, content topic, and responder speed. Question difficulty is dynamically calculated, so it's possible for your candidates' MetaScores to slightly shift as question difficulties evolve."}}
                      %img{src: "https://s3.amazonaws.com/moonlite-nsdub/static/random+icons/tooltip_light.png", style: "width: 16px; height: 16px; display: inline-block; margin-bottom: 3px;"}
              %table.table.overview
                %tbody
                  %tr
                    %td.table_tip
                      - if r[:core].empty?
                        %h3 --
                        %p.tip-below{ data: {tip: "There aren't any multiple choice questions in this Challenge."}} Correct MC
                      - else
                        %h3 #{r[:performance].percent_correct}%
                        %p.tip-below{ data: {tip: "Percent of multiple choice questions answered correctly."}} Correct MC
                    %td.table_tip
                      - if r[:core].empty?
                        %h3 --
                        %p.tip-below{ data: {tip: "There aren't any multiple choice questions in this Challenge."}} Avg. Time per MC
                      - else
                        %h3 #{r[:performance].avg_time_to_answer.round(1)}s
                        %p.tip-below{ data: {tip: "Average response time per correct multiple choice question."}} Avg. Time per MC
                    %td.table_tip
                      - if r[:creative].count == 0
                        %h3 --
                        %p.tip-below{ data: {tip: "There are no Creative Response questions in this Challenge."}} Creative Response 
                      - else
                        %h3= r[:creative].count {|x| not x.content.blank? }.to_s+"/"+r[:creative].count.to_s
                        %p.tip-below{ data: {tip: "Number of submitted Creative Response questions out of total available."}} Creative Response
              - unless path.group_id?
                .strengths_weaknesses
                  .strengths 
                    .header{ style:"font-size: 16px; border-bottom: 1px solid rgba(0,0,0,.1);"}
                      Strengths
                    .body
                      - if r[:performance].strengths.empty?
                        %p{ style: "font-size: 12px;" } More data required.
                      - else
                        %ul
                          - r[:performance].strengths.first(3).each do |topic_name, stats|
                            %li= topic_name
                  .weaknesses 
                    .header{ style:"font-size: 16px; border-bottom: 1px solid rgba(0,0,0,.1);"}
                      Weaknesses
                    .body
                      - if r[:performance].weaknesses.empty?
                        %p{ style: "font-size: 12px;" } More data required.
                      - else
                        %ul
                          - r[:performance].weaknesses.first(3).each do |topic_name, stats|
                            %li= topic_name
                
            - if r[:creative].any?
              %div
                %a.header_link{ "data-target" => "#cr", "data-toggle" => "collapse", :type => "button"}  Creative Response
                #cr.collapse.in{ style: "margin-bottom: 20px;"}
                  %ol
                    - r[:creative].each do |completed_task|
                      %li
                        - total_time = (completed_task.updated_at - completed_task.created_at).round(0)
                        - minutes = total_time / 60
                        - seconds = total_time % 60
                        .answer
                          - task = completed_task.task
                          %p= task.question
                          - if completed_task.submitted_answer.try(:content).blank?
                            .skipped_cr
                              %img{ src: "https://s3.amazonaws.com/moonlite-nsdub/static/random+icons/warning.png"}
                              %p{ style: "display: inline-block; "} Candidate skipped this question. 
                          - else
                            %pre= completed_task.submitted_answer.try(:content).to_s
                            .time_taken_container
                              .time_taken 
                                Completed in 
                                - if minutes != 0 
                                  #{minutes} minutes 
                                - if seconds != 0
                                  #{seconds} seconds
            - if r[:core].any?
              %div
                - if r[:creative].any?
                  %a.header_link{ "data-target" => "#mc_#{path.id}", "data-toggle" => "collapse", :type => "button"} Multiple Choice (click to expand)
                - else
                  %a.header_link Multiple Choice
                %div{ class: "#{"collapse" if r[:creative].any?}", id: "mc_#{path.id}" }
                  %ol
                    - r[:core].each do |completed_task|
                      %li
                        .answer
                          - task = completed_task.task
                          %p= task.question
                          = difficulty_label(task)
                          - if completed_task.correct?
                            .time_taken{ style: "float: right;"} Correct, #{completed_task.points_awarded} points
                          - else
                            .time_taken.incorrect{ style: "float: right;"}  Incorrect
                          %div{ style: "margin-top: 10px;"} 
                            Correct answer:
                            %pre= task.correct_answer.content # Correct answer
                          - if not completed_task.correct?
                            %div 
                              User response:
                              %pre= completed_task.answer # User supplied answer
                          
        
                
                
        
